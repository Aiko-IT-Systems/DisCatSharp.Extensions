"use strict";(()=>{const e="en-US",t=["da","de","en-GB","en-US","es-ES","fr","hr","it","lt","hu","nl","no","pl","pt-BR","ro","fi","sv-SE","vi","tr","cs","el","bg","ru","uk","hi","th","zh-CN","ja","zh-TW","ko"],n=localStorage.getItem("vscodeScheme");let s="vscode-insiders"===n||"vscode"===n?n:navigator.userAgent.includes("Insider")?"vscode-insiders":"vscode";const a="https://github.com/Aiko-IT-Systems/ScWikeloGrind/blob/main",o={report:null,strings:{},locales:[],selected:null,realKeys:new Set},c=e=>document.getElementById(e),i=c("keyList"),r=c("detailsBody"),l=c("summary"),d=c("scheme"),u=c("search"),m=c("filter"),p=c("downloadStrings"),f=c("modalHost");async function g(){const[n,s,a]=await Promise.all([L("/api/report"),L("/api/strings"),L("/api/locales")]);o.report=n,o.realKeys=new Set(Object.keys(s)),o.strings={...s};(n?.missingKeys??[]).forEach(t=>{Object.prototype.hasOwnProperty.call(o.strings,t)||(o.strings[t]={[e]:""})}),o.locales=a&&a.length>0?a:t,l.textContent=`Used ${n.usedKeysCount} / Defined ${n.definedKeysCount} | Missing ${n.missingKeys.length} | Unused ${n.unusedKeys.length} | Dynamic ${n.dynamicKeyUsages.length}`,y(),h(o.selected)}function y(){if(!o.report)return;const t=u.value.toLowerCase(),n=m.value,s=function(t){const n=new Set;return n.add(e),Object.values(t).forEach(e=>{Object.keys(e||{}).forEach(e=>n.add(e))}),n}(o.strings),a=Object.keys(o.strings),c=o.report?.missingKeys??[],r=(o.report.dynamicKeyUsages||[]).map(e=>k(e)).filter(e=>e&&e.includes(".")),l=Array.from(new Set([...a,...r,...c])).sort((e,t)=>e.localeCompare(t));i.innerHTML="";const d=document.getElementById("key-item-template");l.forEach(a=>{const r=o.strings[a]||{},l=Object.values(r).join(" ").toLowerCase();if(t&&!a.toLowerCase().includes(t)&&!l.includes(t))return;const u=c.includes(a),m=o.report.dynamicKeyUsages.some(e=>k(e)===a),p=!m&&(!o.realKeys.has(a)||u),f=o.report.unusedKeys.includes(a),g=!r[e]||0===r[e].trim().length,y=!p&&!m&&(g||function(e,t){for(const n of t){const t=e?.[n]??"";if(!t||0===t.trim().length)return!0}return!1}(r,s)),v=m;if("kmissing"===n&&!p)return;if("lmissing"===n&&!y)return;if("unused"===n&&!f)return;if("dynamic"===n&&!v)return;const E=d.content.firstElementChild.cloneNode(!0);E.querySelector(".key-text").textContent=a;const w=E.querySelector(".badges");w.style.flexWrap="wrap",p&&w.append($("Missing Key","danger")),f&&w.append($("Unused","warn")),!p&&y&&w.append($("Missing Locale","danger")),v&&w.append($("Dynamic","success")),E.addEventListener("click",()=>h(a)),o.selected===a&&E.classList.add("selected"),i.append(E)})}function h(t){if(o.selected=t,!t)return r.className="details-empty",void(r.textContent="Select a key to edit");const n=o.realKeys.has(t),c=o.report?.dynamicKeyUsages.some(e=>k(e)===t),i=o.report?.dynamicKeyCandidates?.[t]??[],l=o.strings[t]||{[e]:""},d=w(Object.keys(l)),u=document.createElement("div");u.className="details";const m=document.createElement("div");if(m.innerHTML=`<strong>${t}</strong>${n||c?"":' <span class="badge warn">Missing Key</span>'}`,u.append(m),!n&&!c){const e=document.createElement("div");e.className="details-empty",e.textContent="This key is missing from strings.json. Fill in values and Save to create it.",u.append(e)}if(c){const e=document.createElement("div");e.className="details-empty",e.textContent="Dynamic key: manage concrete keys instead.",u.append(e)}else{const e=document.createElement("div");e.className="translations",d.forEach(t=>{e.append(v(t,l[t]??""))});const n=document.createElement("div");n.className="translation-add-row";const s=document.createElement("select"),a=w(o.locales),c=new Set(d),i=a.filter(e=>!c.has(e));s.innerHTML=`<option value="">Select locale</option>${i.map(e=>`<option value="${e}">${e}</option>`).join("")}`;const r=document.createElement("button");r.textContent="Add locale",r.className="secondary",r.onclick=()=>{const t=s.value;t&&(e.querySelector(`[data-locale="${t}"]`)||(e.insertBefore(v(t,""),n),s.value=""))};const m=document.createElement("div");m.className="footer-actions";const p=document.createElement("button");p.textContent="Save",p.classList.add("success"),p.onclick=()=>async function(e,t){if(!await N("Save changes?","This will write updates to strings.json."))return;const n={};t.querySelectorAll(".translation-row").forEach(e=>{const t=e.dataset.locale,s=e.querySelector("textarea").value;t&&(n[t]=s)});const s=await fetch(`/api/strings/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,translations:n})});if(!s.ok){const e=await x(s);return void alert(`Save failed: ${e}`)}await g(),h(e),b("Saved")}(t,e);const f=document.createElement("button");f.textContent="Delete",f.className="danger",f.onclick=()=>async function(e){const t=await N("Delete key?",`This removes '${e}' from strings.json.`);if(!t)return;const n=await fetch(`/api/strings/${encodeURIComponent(e)}`,{method:"DELETE"});if(!n.ok){const e=await x(n);return void alert(`Delete failed: ${e}`)}await g(),h(null),b("Deleted")}(t),m.append(p,f),n.append(s,r,m),e.append(n),u.append(e)}const p=document.createElement("div");p.className="usage",p.innerHTML="<strong>Usages</strong>";const f=document.createElement("div"),y=o.report?.keyUsages[t]||[],E=(o.report?.dynamicKeyUsages||[]).filter(e=>k(e)===t),$=document.getElementById("usage-row-template"),L=(o.report?.repoRoot||"").replace(/\\/g,"/");if(y.length>0&&y.forEach(e=>{const t=$.content.firstElementChild.cloneNode(!0);t.querySelector(".usage-file").textContent=`${e.file} : ${e.line}`;const n=`${L}/${e.file}`.replace(/\\/g,"/");S(t).onclick=()=>{const t=`${s}://file/${encodeURI(n)}:${e.line}`;window.open(t,"_blank")};const o=t.querySelector(".usage-copy"),c=`${a}/${e.file.replace(/\\/g,"/")}#L${e.line}`;o.onclick=()=>C(c,"Git link copied"),f.append(t)}),E.length>0&&E.forEach(e=>{const t=$.content.firstElementChild.cloneNode(!0);t.querySelector(".usage-file").textContent=`${e.file} : ${e.line} (dynamic: ${e.reason??""})`;const n=`${L}/${e.file}`.replace(/\\/g,"/");S(t).onclick=()=>{const t=`${s}://file/${encodeURI(n)}:${e.line}`;window.open(t,"_blank")};const o=t.querySelector(".usage-copy"),c=`${a}/${e.file.replace(/\\/g,"/")}#L${e.line}`;o.onclick=()=>C(c,"Git link copied"),f.append(t)}),0===y.length&&0===E.length){const e=document.createElement("div");e.textContent="No usages found.",e.className="details-empty",f.append(e)}if(p.append(f),u.append(p),c&&i.length>0){const e=document.createElement("div");e.className="usage",e.innerHTML="<strong>Candidate keys</strong>";const t=document.createElement("div");t.className="candidate-list",i.forEach(e=>{const n=document.createElement("div");n.className="details-empty",n.textContent=e,n.style.cursor="pointer",n.onclick=()=>h(e),t.append(n)}),e.append(t),u.append(e)}r.className="",r.innerHTML="",r.append(u)}function v(t,n){const s=document.createElement("div");s.className="translation-row",s.dataset.locale=t;const a=document.createElement("input");a.value=t,a.disabled=!0;const o=document.createElement("textarea");o.value=n??"",E(o),o.addEventListener("input",()=>E(o));const c=document.createElement("button");return c.textContent="Remove",c.className="danger",c.onclick=()=>{t!==e&&s.remove()},t===e&&(c.disabled=!0,c.textContent="Primary"),s.append(a,o,c),s}function E(e){e.style.height="auto",e.style.height=`${e.scrollHeight}px`}function w(t){return[...t].sort((t,n)=>t===n?0:t===e?-1:n===e?1:t.localeCompare(n))}function $(e,t){const n=document.createElement("span");return n.className=`badge ${t}`,n.textContent=e,n}function k(e){if(!e)return"";const t=e.expression||"";return function(e){let t=e.trim();t.startsWith("@$")?t=t.slice(2):t.startsWith("$")&&(t=t.slice(1));t=t.replace(/^"/,"").replace(/"$/,"");const n=t.indexOf("{");n>=0&&(t=t.slice(0,n));return t.trim()}(t)||t||""}function S(e){let t=e.querySelector(".usage-open");if(!t){t=document.createElement("button"),t.className="usage-open",t.textContent="Open in VS Code";(e.querySelector(".usage-actions")||e).prepend(t)}return t}function C(e,t){navigator.clipboard?.writeText(e).then(()=>b(t))}function b(e){const t=document.createElement("div");t.className="toast",t.textContent=e,document.body.append(t),setTimeout(()=>t.remove(),2e3)}function N(e,t){return new Promise(n=>{const s=document.createElement("div");s.className="modal-backdrop";const a=document.createElement("div");a.className="modal",a.innerHTML=`<h3>${e}</h3><p>${t}</p>`;const o=document.createElement("div");o.className="modal-actions";const c=document.createElement("button");c.className="ghost",c.textContent="Cancel";const i=document.createElement("button");i.className="danger",i.textContent="Confirm",c.onclick=()=>{s.remove(),n(!1)},i.onclick=()=>{s.remove(),n(!0)},o.append(c,i),a.append(o),s.append(a),f.append(s)})}async function L(e){const t=await fetch(e);if(!t.ok){const e=await x(t);throw new Error(e)}return t.json()}async function x(e){try{const t=await e.json();return t?.message?t.message:`${e.status} ${e.statusText}`}catch{return`${e.status} ${e.statusText}`}}c("refresh").addEventListener("click",async function(){try{await g(),b("Refreshed")}catch(e){const t=e?.message||String(e);alert(`Refresh failed: ${t}`)}}),c("addKey").addEventListener("click",async function(){const t=prompt("New translation key");if(!t)return;const n=await fetch("/api/strings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t,translations:{[e]:""}})});if(!n.ok){const e=await x(n);return void alert(`Add failed: ${e}`)}await g(),h(t)}),c("beautify").addEventListener("click",async function(){if(!await N("Beautify strings.json?","This will rewrite strings.json with formatting."))return;const e=await fetch("/api/strings/format",{method:"POST"});if(!e.ok){const t=await x(e);return void alert(`Beautify failed: ${t}`)}await g(),b("Formatted")}),p.addEventListener("click",async function(){try{const e=await fetch("/api/strings");if(!e.ok)throw new Error(await x(e));const t=await e.json(),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download="strings.json",a.click(),URL.revokeObjectURL(s),b("Downloaded strings.json")}catch(e){alert(`Download failed: ${e}`)}}),d.addEventListener("change",()=>{s=d.value,localStorage.setItem("vscodeScheme",s),h(o.selected)}),d.value=s,u.addEventListener("input",y),m.addEventListener("change",y),g()})();
//# sourceMappingURL=app.js.map